<html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="../book.css" type="text/css" />
        <title>UDIG Developer Guide : 2 Catalog</title>
    </head>
    <body BGCOLOR="#FFFFFF">
       <!-- UDIG Developer Guide : 2 Catalog -->
       <h1>2 Catalog</h1>

       <p>The uDIg Catalog is used to mange and interact with spatial resources.</p>

<div>
<ul>
    <li><a href='#2Catalog-CatalogPlugin'>CatalogPlugin</a></li>
<ul>
    <li><a href='#2Catalog-CatalogPluginOverview'>CatalogPlugin Overview</a></li>
    <li><a href='#2Catalog-UsingtheLocalCatalog'>Using the Local Catalog</a></li>
    <li><a href='#2Catalog-UsingtheListofCatalogs'>Using the List of Catalogs</a></li>
</ul>
    <li><a href='#2Catalog-ICatalog'>ICatalog</a></li>
<ul>
    <li><a href='#2Catalog-OverviewofAPI'>Overview of API</a></li>
    <li><a href='#2Catalog-OverviewofLocalAPI'>Overview of Local API</a></li>
</ul>
    <li><a href='#2Catalog-IGeoResource'>IGeoResource</a></li>
<ul>
    <li><a href='#2Catalog-IGeoResourceAPIOverview'>IGeoResource API Overview</a></li>
    <li><a href='#2Catalog-UseofIGeoResourceInfo'>Use of IGeoResourceInfo</a></li>
</ul>
    <li><a href='#2Catalog-IService'>IService</a></li>
<ul>
    <li><a href='#2Catalog-IServiceOverview'>IService Overview</a></li>
</ul>
    <li><a href='#2Catalog-IResolve'>IResolve</a></li>
<ul>
    <li><a href='#2Catalog-IResolveOverview'>IResolve Overview</a></li>
    <li><a href='#2Catalog-UseofcanResolveandresolvemethods'>Use of canResolve and resolve methods</a></li>
    <li><a href='#2Catalog-ComparisonwithIResource'>Comparison with IResource</a></li>
</ul>
    <li><a href='#2Catalog-ExtendingCatalogPlugin%28Advanced%29'>Extending Catalog Plugin (Advanced)</a></li>
<ul>
    <li><a href='#2Catalog-ResolutionManager'>Resolution Manager</a></li>
    <li><a href='#2Catalog-EclipseIDEIntegration'>Eclipse IDE Integration</a></li>
</ul>
</ul></div>

<p>The style of programming used for the uDig Catalog is similar to that of the Eclipse IDE (where concepts such as Project / IResource / IFile are defined). </p>

<p>Since uDig does not depend on the Eclipse IDE (we have no need of a compile / build cycle) we provide are making use of our own interfaces ICatalog, IService and IGeoResource covered on this page. By making use of our own API we also have been able to address a number of concerns specific to spatial data; almost all our data is so bug, or remote, or both that latency is an issue. It is very important to us that you know when you are making use of spatial data that make take some time to process, or has the possibility of an I/O error.</p>

<h1><a name="2Catalog-CatalogPlugin"></a>CatalogPlugin</h1>

<p>The CatalogPlugin provides the following services:</p>
<ul>
	<li>The concept of Handles to actual Resources</li>
	<li>Discovery of additional resources using Search facilities</li>
	<li>Programmatic Management of spatial resources</li>
</ul>


<p>The CatalogPlugin supports several formats right out of the box and is easily extended for custom content.</p>

<h2><a name="2Catalog-CatalogPluginOverview"></a>CatalogPlugin Overview</h2>

<p>CatalogPlugin provides for the following:</p>
<ul>
	<li>ID - convenience field, this is the same value used by plugin extention point, can be used to locate Platform resources associated with the CatalogPlugin</li>
	<li>getDefault() - the single instance of the CatalogPlugin</li>
	<li>addListener( .. ) â€" listen to resource change notification</li>
	<li>removeListener( .. ) â€" stop listening for change notification</li>
	<li>getCatalogs() - known catalogs, including registered web catalogs</li>
	<li>getLocalCatalog() - catalog of known resources</li>
	<li>getServiceFactory() - used to create new content from a URL</li>
</ul>


<p>The Catalog plug-in is the "Activator" class for <b>net.refractions.udig.catalog</b> - as such it extends AbstractUIPlugin for the following:</p>
<ul>
	<li>getDialogSettings() - used to hold persistent state data for wizards and plug-ins</li>
	<li>getImageRegistry() - images that are shared for frequently used within the plug-in</li>
	<li>getPreferenceStore() - used to hold persistent user or internal settings</li>
</ul>


<h2><a name="2Catalog-UsingtheLocalCatalog"></a>Using the Local Catalog</h2>

<p>The CatalogPlugin is mostly used to access a single Local Catalog used to manage live connections to your databases, external services and local files. The local catalog is used to track all "active" data connections; even if you find information in a remote catalog, it will be added to the local catalog as you start to use it.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">ICatalog catalog = CatalogPlugin.getLocalCatalog();
IGeoResourceImpl shapefile = catalog.getById( IGeoResource.class, url, progressmonitor );</pre>
</div></div>

<p>The above code looks up an existing service in the catalog, for more information (including adding new data) please check out the section on ICatalog below.</p>

<h2><a name="2Catalog-UsingtheListofCatalogs"></a>Using the List of Catalogs</h2>

<p>The CatalogPlugin keeps track of all the catalogs (local and remote) that can be used to find spatial content.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">for</span>( ICatalog catalog : CatalogPlugin.getCatalogs() ){
    <span class="code-keyword">try</span> {
       catalog.search( pattern, bbox, process );
    }
    <span class="code-keyword">catch</span>( IOException problem ){
        catalog.getLog(
            <span class="code-keyword">new</span> Status( IStatus.WARNING, CatalogPlugin.ID, IStatus.OK, <span class="code-quote">"Failed to search with:"</span>+pattern, t)
        );
    }
}</pre>
</div></div>
<p>The above example makes use of CatalogPlugin, any problems are reported using the CatalogPlugin ID to the logging system. We will cover some of the other uses of ICatalog below.</p>

<h1><a name="2Catalog-ICatalog"></a>ICatalog</h1>

<p>ICatalog is the interface used to represent a generic "catalog" of spatial resources and services, you can think of it as being similar to a web search engine.</p>

<h2><a name="2Catalog-OverviewofAPI"></a>Overview of API</h2>

<p>The following ICatalog methods are used when working with remote services:</p>
<ul>
	<li>getInfo( IProgressMonitor ) - description of the catalog</li>
	<li>find( URL, IProgressMonitor ) - retrieve a list of services (or resources) for the provided URL, including all known alternatives.</li>
	<li>search( String, Envelope, IProgressMonitor ) - used to query the catalog using a text pattern and bounding box</li>
</ul>


<p>Please keep in mind that the catalog tracks a great deal of information about your services and resources; the reason find returns a list (rather than just a single entry) is the same information may be available from a number of sources. Having a range of alternatives available is useful in a world where external servers are sometimes down for maintenance.</p>

<h2><a name="2Catalog-OverviewofLocalAPI"></a>Overview of Local API</h2>

<p>The local catalog (implemented by the <b>CatalogImpl</b> class) is responsible for managing a list of all the services known to the uDig application. The local catalog is also responsible for tracking which Services are in use and tracking any life cycle changes (some services such as Databases are expensive to connect to and care must be taken to clean up after their use).</p>

<p>The following ICatalog methods are used when working with a local catalog</p>
<ul>
	<li>add( IService ) - add a service to the catalog</li>
	<li>remove( IService ) - used to communicate when a service is removed (such as a file being deleted from disk)</li>
	<li>replace( URL, IService ) - used to communicate when a service changes location (such as a file moving on disk)</li>
	<li>createTemporaryResource( Object ) - used to create a temporary resources, usually by using a FeatureType</li>
	<li>getTemporaryDescriptorClasses() - list of classes for which a temporary resource can be created</li>
</ul>


<p>The following ICatalog methods are safe to call from a user interfae (ie are non blocking):</p>
<ul>
	<li>getById( Class, URL, ProgressMonitor ) - used to look up an exact match</li>
	<li>addCatalogListener( IResolveChangeListener ) - watch the catalog for changes</li>
	<li>removeCatalogListener( IResolveChangeListener ) - stop watching the catalog for changes</li>
</ul>


<h1><a name="2Catalog-IGeoResource"></a>IGeoResource</h1>

<p>Lets start with the most specific, and the most useful, resource stored in a Catalog. The IGeoResource interface represents real information, the kind you can display on screen or perform analysis on.</p>

<p>Here are a few examples to get us started with:</p>
<ul>
	<li>A Table or View in a database</li>
	<li>A FeatureCollection made available through a Web Feature Server (WFS)</li>
	<li>A Web Map Server (WMS) Layer</li>
	<li>The contents of a shapefile</li>
	<li>A GridCoverage contained in an ArcGrid file</li>
</ul>


<p>The <b>IGeoResource</b> implementation does not place any restrictions on the interface used to interact with the external resource. That said here are our top contenders for most popular interface:</p>

<p>From GeoTools:</p>
<ul>
	<li><b>org.geotools.data.FeatureSource</b> used to represent Feature information available in a File, Database or Web Feature Server</li>
	<li><b>org.geotools.data.FeatureStore</b> used to represent Feature information that allows modification.</li>
	<li><b>org.geotools.data.ows.Layer</b> represents a externalized rendering service advertised by a WMS</li>
	<li><b>org.geotools.coverage.io.AbstractGridCoverageReader</b> represents raster information such as GeoTIFF or ArcGRID content</li>
</ul>


<p>From Java:</p>
<ul>
	<li><b>java.sql.Connection</b> a JDBC connection used to directly communicate with a database</li>
</ul>


<p>Please see the Advanced section for details on making your own content available: CAD file formats, feature content from other toolkits, and dynamically generated content are all exciting possibilities.</p>

<h2><a name="2Catalog-IGeoResourceAPIOverview"></a>IGeoResource API Overview</h2>

<ul>
	<li>getInfo( IProgressMonitor ) access to a GeoResourceInfo describing this resource</li>
	<li>service( IPorgressMonitor ) the service providing this resource</li>
	<li>getIdentifier() identifier used to locate the resource in the catalog</li>
	<li>dispose( IProgressMonitor )</li>
</ul>


<p>IGeoResource instances can formed into a tree:</p>
<ul>
	<li>members( IProgressMonitor ) - used to treat IGeoResource like a folder that contains more content</li>
	<li>parent( IProgressMonitor ) - the parent containing this IGeoResource</li>
</ul>


<h2><a name="2Catalog-UseofIGeoResourceInfo"></a>Use of IGeoResourceInfo</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">....pending...</pre>
</div></div>

<h1><a name="2Catalog-IService"></a>IService</h1>

<p>The CatalogPlugin uses the interface IService to model a local or remote service. </p>

<p>Here are some examples to get us started:</p>
<ul>
	<li>A remote Database</li>
	<li>A local File on disk</li>
	<li>A Web Feature Server</li>
	<li>An "internal" service such as the MapGraphics included with uDig</li>
</ul>


<h2><a name="2Catalog-IServiceOverview"></a>IService Overview</h2>

<ul>
	<li>parent( IProgressMonitor ) - the ICatalog where the Service was found</li>
	<li>getInfo( IProgressMonitor ) - access a ServiceInfo describing the service</li>
	<li>members( IProgressMonitor ) - list the contents of the Service, may be organized into folders, or schema depending on the service, usually this is just a list of IGeoResource</li>
	<li>getConnectionParameters() - connection parameters used by the local catalog to "connect" to the service</li>
</ul>


<p>If a IService is making spatial data available; there is a helper method available that will list all GeoResources</p>
<ul>
	<li>resources( IProgerssMonitor )</li>
</ul>


<h1><a name="2Catalog-IResolve"></a>IResolve</h1>

<p>CatalogPlugin uses the model of a "handle" to allow access to spatial resources.</p>

<p>The concept of a resource handle is represented as the IResolve class:</p>
<ul>
	<li>acts as a <b>Proxy</b> for remote content, you can ask a few basic questions (say askign for the bounds) without having to connect to the real remote service</li>
	<li>acts as an "Adapter" for interacting with data, you can turn your IResolve into the object you really want, behind the scenes the catalog will make the connection and return you the class used to interact with data.</li>
	<li>acts as an "Extensible Interface", you can make up your own data access APIs and teach the catalog how to make use of them</li>
</ul>


<h2><a name="2Catalog-IResolveOverview"></a>IResolve Overview</h2>

<p>Here are the core responsibilities of IResolve interface:</p>
<ul>
	<li>IResolve.getIdentifier() is a unique URL used to identify this resource in the catalog</li>
	<li>IResolve.canResolve( Class type ) is a non blocking check to see if a <b>type</b> of resource is available for the handle</li>
	<li>IResolve.resolve( Class type, IProgressMonitor monitor ) will acquire the requested resource</li>
</ul>


<p>IResolve handles can form a tree using the following methods:</p>
<ul>
	<li>members( IResolve parent, IProgressMonitor )</li>
	<li>parent( IProgressMonitor )</li>
</ul>


<p>Finally, just because a handle exists does not mean the real resource resources exists or is working. A service may be down, or a shapefile may not be created yet.</p>

<p>Here is how to check on the status of a IResolve:</p>
<ul>
	<li>IResolve.getStatus(), one of CONNECTED, NOTCONNECTED or BROKEN</li>
</ul>


<p>Note: Methods that are blocking make use of a IProgressMonitor, and throw an IOException in the event of a problem. This allows for both feedback during the operation, and strongly indicates to calling code that blocking input/output will occur.</p>

<p>Let's quickly work with an example (to make this real)</p>

<h2><a name="2Catalog-UseofcanResolveandresolvemethods"></a>Use of canResolve and resolve methods</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> count shapes( File shapefile ){
    CatalogPlugin catalog = CatalogPlugin.getDefault();
    IServiceFactory factory = catalog.getServiceFactory();
    <span class="code-keyword">for</span>( IResolve resolve : factory.acquire( shapefile.toUrl() ) ){
       <span class="code-keyword">if</span>( resolve.canResolve( DataStore.class ) ){
           DataStore shape = resolve.resolve( DataStore.class );
           <span class="code-object">String</span> typeName = shape.getTypeNames()[0];
           <span class="code-keyword">return</span> shape.getFeatureSource( typeName ).count();
       }
    }
    <span class="code-keyword">return</span> 0;
}</pre>
</div></div>

<h2><a name="2Catalog-ComparisonwithIResource"></a>Comparison with IResource</h2>

<p>The IResolve interface follows the same design as the normal Eclipse IResource class.</p>

<p>IResolve offers the following advantages over normal Eclipse IResource:</p>
<ul>
	<li>IResolve explicitly represents a handle for a remote resource</li>
	<li>IResolve blocking behavior is explicit at the API level, anything that takes an IProgressMonitor or throws an IOException is blocking</li>
	<li>IResolve is available for RCP applications, normal IResource is part of the Eclipse IDE and cannot be used in a RCP application</li>
	<li>IResolve uses Java 5 enums, type narrowing and Templates for a simplified API</li>
</ul>


<h1><a name="2Catalog-ExtendingCatalogPlugin%28Advanced%29"></a>Extending Catalog Plugin (Advanced)</h1>

<p>To extend catalog for additional formats you will need to make an implementation of IService, IGeoResource and a WizardPage for your new content.</p>
<ul>
	<li>ServiceExtention: allow the catalog to work with new kinds of Services</li>
	<li>ICatalog: teach the CatalogPlugin about new kinds of remote catalogs</li>
	<li>temporaryResource: create new temporary resources</li>
	<li>resolvers: teach the existing IResolve Implementations (like ShpGeoResource) about your application needs</li>
	<li>friendly: build up assocations between services that are designed to work together</li>
</ul>


<p>We are going to launch right into technical details here (this is the advanced section). If you require additional background information please consider the following references:</p>
<ul>
	<li>Contributing to Eclipse (nice explanation of IResource, and IAdaptable)</li>
	<li><a href="2 Eclipse House Rules.html" title="2 Eclipse House Rules">2 Eclipse House Rules</a></li>
</ul>


<p>Common mistakes:</p>
<ul>
	<li>If you are used to making your own Eclipse plugins you may accidently depend on IResource, it will not be available at runtime since it is part of the Eclipse IDE.</li>
	<li><a href="2 Eclipse House Rules.html" title="2 Eclipse House Rules">2 Eclipse House Rules</a>: You may only depend on public API packages (example net.refractions.udig.catalog). This is less of a problem since we are able to properly restrict packages in Eclipse 3.3.</li>
</ul>


<h2><a name="2Catalog-ResolutionManager"></a>Resolution Manager</h2>

<p>Just because the core uDig team knows how to do a few tricks with Shapefiles, and turn them into a FeatureSource does not mean you are left out of the game.  You can teach the uDig catalog system new tricks, making uDig classes aware of your applications needs at runtime.</p>

<p><img src="download/attachments/3459/resolvemanager.png" align="absmiddle" border="0"/></p>

<p>The ResolutionManager processes an extention point binding IResolve to new classes, you can use this facility to integrate your own functionality with the uDig application.</p>

<h2><a name="2Catalog-EclipseIDEIntegration"></a>Eclipse IDE Integration</h2>

<p>When making your own instance of IResolve you can also implement IAdaptable (we ensured that no method names would conflict). Implementing IAdaptable, and providing an adapter for IResource allows for seamless integration with the Eclipse IDE.</p>

<p>This is out of scope for our current development effort - however the implementation is straight forward and would allow integration of the GISPlatform with the wider Eclipse community. The Eclipse workbench already checks for the classes supporting IAdaptable, and will automatically integrate any class that responds to isAdaptable( IResource.class ).</p>

<small>
  (c) Copyright (c) 2004-2008 Refractions Research Inc. and others.<br>
  <a href="http://udig.refractions.net/confluence/pages/viewpage.action?pageId=3459">[wiki]</a>
</small>
    </body>
</html>
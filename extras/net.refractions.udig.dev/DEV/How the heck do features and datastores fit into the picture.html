<html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="../book.css" type="text/css" />
        <title>UDIG Developer Guide : How the heck do features and datastores fit into the picture</title>
    </head>
    <body BGCOLOR="#FFFFFF">
       <!-- UDIG Developer Guide : How the heck do features and datastores fit into the picture -->
       <h1>How the heck do features and datastores fit into the picture</h1>

       <p>At the uDig level there are IServices and IGeoResources.  These are generic handles to something "real" for example a IService can be a handle to a WMS or a Datastore.  An IGeoResource can be a handle to a "FeatureSource" or "GridCoverage".</p>

<p>Next are uDig layers.  A layer references a IGeoReource... Actually since two IGeoResources and refer to the same data (for example a WMS Layer and a WFS FeatureCollection backed onto the same data) a layer can reference one or more IGeoResources <b>BUT</b> only 1 data.  A layer has functionality allowing inspection of the georesources and also map specific information that is unrelated to the IGeoResource, for example a map name and a style.</p>

<p>Renderers draw layers.  There are many different types of renderers.  Some renderers can render Vector data, others can render GridCoverages or make WMS requests.  The BasicFeatureRenderer, for example, only works for Layers that has a IGeoResource that is a handle for a FeatureSource.</p>

<p>That is all at the uDig level.  uDig uses the Geotools library extensively so most of the current IServices and IGeoResources are handles for Geotools objects.  Geotools has DataStores and FeatureSources for Vector data.  A DataStore is a peer of IService.  An example of a Datastore is a PostGIS database.  FeatureSources can be obtained from DataStores and are a peer of IGeoResource.  FeatureSources can be used to obtain features of a particular feature type from a DataStore.  FeatureSources are read-only.  If the Datastore is read-write you can do an instance check on the FeatureSource to see if it is a FeatureStore.  FeatureStores provide methods for adding/removing/modifying features.</p>

<p>The next obvious question is: If I am in uDig how do I get a FeatureSource?  Here are some common scenarios that occur in uDig.</p>

<p>Scenario 1.  You have a layer and you want a feature source.  </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">layer.getResource( FeatureSource.class, monitor );</pre>
</div></div>
<p>This is a blocking call you can do a non-blocking check to see if the layer has a FeatureSource by:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">layer.hasResource( FeatureSource.class );</pre>
</div></div>

<p>Scenario 2.  You have a IGeoResource and you want a FeatureSource.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span>( resource.canResolve( FeatureSource.class ) )
    <span class="code-keyword">return</span> resource.resolve( FeatureSource.class );</pre>
</div></div>

<p><b>NOTE:</b>  If it is possible always obtain a FeatureSource from a layer.  This is because uDig's EditManager manages transactions for the user (and developer).   FeatureSources by default use auto commit transactions where the FeatureSource obtained from a layer uses a transaction.  </p>

<small>
  (c) Copyright (c) 2004-2008 Refractions Research Inc. and others.<br>
  <a href="http://udig.refractions.net/confluence/pages/viewpage.action?pageId=8480">[wiki]</a>
</small>
    </body>
</html>
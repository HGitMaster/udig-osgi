<html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="../book.css" type="text/css" />
        <title>UDIG Developer Guide : Login Example</title>
    </head>
    <body BGCOLOR="#FFFFFF">
       <!-- UDIG Developer Guide : Login Example -->
       <h1>Login Example</h1>

       <p>Setting up an UDIGApplication that requires a login is a common request. This example shows how to use the checkLogin() method to talk to a "Client" plug-in and call its login method.</p>
<div>
<ul>
    <li><a href='#LoginExample-checkLogin'>checkLogin</a></li>
    <li><a href='#LoginExample-LoginDialog'>LoginDialog</a></li>
</ul></div>

<p>The "Client' plug-in technique is used when you have a Client plugin that holds on to a Spring remoting Session with a J2EE server application.</p>

<h1><a name="LoginExample-checkLogin"></a>checkLogin</h1>

<p>Here is an example of overriding the UDIGApplication checkLogin() method.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> <span class="code-object">boolean</span> checkLogin() {
        LoginDialog loginDialog = <span class="code-keyword">new</span> LoginDialog(
                <span class="code-quote">"Connecting Communities Login"</span>,
                <span class="code-quote">"Please login to Connecting Communities:"</span> );
        
        <span class="code-object">boolean</span> login= <span class="code-keyword">false</span>;
        <span class="code-keyword">while</span>( !login ){
            <span class="code-object">int</span> result = loginDialog.open();                    
            <span class="code-keyword">if</span>( result == MessageDialog.OK){
                <span class="code-keyword">try</span> {
                    login = Client.getDefault().login( loginDialog.getUser(), loginDialog.getPassword() );
                    <span class="code-keyword">if</span>( !login ){
                        loginDialog.setMessage(<span class="code-quote">"Could not login - please <span class="code-keyword">try</span> again"</span>);
                    }                    
                } <span class="code-keyword">catch</span> (Exception connectionProblem) {
                    MessageDialog.openInformation(<span class="code-keyword">null</span>, <span class="code-quote">"Could not Connect"</span>, connectionProblem.toString() );
                    
                    <span class="code-keyword">return</span> <span class="code-keyword">false</span>; <span class="code-comment">// probably should prompt user here?
</span>                }
            }
            <span class="code-keyword">else</span> {
                <span class="code-keyword">return</span> <span class="code-keyword">false</span>; <span class="code-comment">// user cancelled
</span>            }
        }
        <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
    }</pre>
</div></div>

<h1><a name="LoginExample-LoginDialog"></a>LoginDialog</h1>

<p>The above example made use of a really simple MessageDialog shown bellow:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class LoginDialog <span class="code-keyword">extends</span> MessageDialog {
    <span class="code-object">String</span> user;
    <span class="code-object">String</span> password;
    <span class="code-keyword">public</span> LoginDialog( <span class="code-object">String</span> title, <span class="code-object">String</span> dialogMessage) {
        <span class="code-keyword">super</span>(<span class="code-keyword">null</span>, title, <span class="code-keyword">null</span>, dialogMessage, QUESTION,
                <span class="code-keyword">new</span> <span class="code-object">String</span>[]{<span class="code-quote">"Login"</span>,<span class="code-quote">"Exit"</span>}, 0 );            
    }

    <span class="code-keyword">protected</span> Control createCustomArea(Composite parent) {
        Composite composite = <span class="code-keyword">new</span> Composite(parent, SWT.NONE);
        composite.setLayout( <span class="code-keyword">new</span> GridLayout(2,<span class="code-keyword">false</span>) );
                    
        Label label = <span class="code-keyword">new</span> Label( composite, SWT.RIGHT );
        label.setText(<span class="code-quote">"User:"</span>);
        GridData gridData = <span class="code-keyword">new</span> GridData( SWT.FILL, SWT.FILL, <span class="code-keyword">false</span>, <span class="code-keyword">false</span> );
        gridData.widthHint = 100; <span class="code-comment">// just a suggestion
</span>        label.setLayoutData( gridData );
                    
        <span class="code-keyword">final</span> Text userText = <span class="code-keyword">new</span> Text( composite, SWT.SINGLE );
        userText.setLayoutData( <span class="code-keyword">new</span> GridData( SWT.FILL, SWT.CENTER, <span class="code-keyword">true</span>, <span class="code-keyword">false</span> ));
        userText.addModifyListener( <span class="code-keyword">new</span> ModifyListener(){
            <span class="code-keyword">public</span> void modifyText( ModifyEvent e ) {
                user = userText.getText();
            }                
        });
        
        label = <span class="code-keyword">new</span> Label( composite, SWT.RIGHT );
        label.setText(<span class="code-quote">"Password:"</span>);
        label.setLayoutData( gridData );
        
        <span class="code-keyword">final</span> Text passwordText = <span class="code-keyword">new</span> Text ( composite, SWT.SINGLE | SWT.PASSWORD );
        passwordText.setLayoutData( <span class="code-keyword">new</span> GridData( SWT.FILL, SWT.CENTER, <span class="code-keyword">true</span>, <span class="code-keyword">false</span> ));
        passwordText.addModifyListener( <span class="code-keyword">new</span> ModifyListener(){
            <span class="code-keyword">public</span> void modifyText( ModifyEvent e ) {
                user = passwordText.getText();
            }                
        });
        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
    }
    
    <span class="code-keyword">public</span> <span class="code-object">String</span> getUser() {
        <span class="code-keyword">return</span> user;
    }
    <span class="code-keyword">public</span> <span class="code-object">String</span> getPassword() {
        <span class="code-keyword">return</span> password;
    }
    <span class="code-keyword">public</span> void setMessage( <span class="code-object">String</span> message ){
        messageLabel.setText( message );
    }
}</pre>
</div></div>

<small>
  (c) Copyright (c) 2004-2008 Refractions Research Inc. and others.<br>
  <a href="http://udig.refractions.net/confluence/pages/viewpage.action?pageId=2130347">[wiki]</a>
</small>
    </body>
</html>
<html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="../book.css" type="text/css" />
        <title>UDIG Developer Guide : How do I configure keyboard shortcuts</title>
    </head>
    <body BGCOLOR="#FFFFFF">
       <!-- UDIG Developer Guide : How do I configure keyboard shortcuts -->
       <h1>How do I configure keyboard shortcuts</h1>

       <p><b>Q:</b> How do I configure keyboard shortcuts</p>

<p><b>A:</b><br/>
<b>Definitions:</b></p>
<ul>
	<li>Command - an abstract representation of some semantic behaviour, but not it's actual implementation</li>
	<li>Key Binding - a mapping between a certain group of conditions, some user input and a triggered command</li>
	<li>Scheme - set of one or more bindings</li>
	<li>Context - Definition of a context where key bindings are active</li>
</ul>


<p>There are many steps that must be take in order to define a completely new command and assign it to an Action.</p>
<ol>
	<li>Define a org.eclipse.ui.command extension for the new command
	<ol>
		<li>Define a category (part of the org.eclipse.ui.command extension) of the command.  (You can also use an existing category if one that applies exists).</li>
		<li>Define the command (part of the org.eclipse.ui.command extension)</li>
	</ol>
	</li>
	<li>Define an org.eclipse.ui.contexts extension (or reuse and existing one).  Common contexts are:</li>
</ol>
<ul>
	<li>org.eclipse.ui.textEditorScope</li>
	<li>org.eclipse.ui.contexts.dialogAndWindow</li>
	<li>org.eclipse.ui.contexts.window</li>
	<li>org.eclipse.ui.contexts.dialog</li>
	<li>net.refractions.udig.project.ui.tool</li>
</ul>
<ol>
	<li>Define a org.eclipse.ui.bindings extension
	<ol>
		<li>Define a scheme (or use udig's default scheme: net.refractions.udig.defaultUDIGKeyConfiguration ).  Schemes are part of the org.eclipse.ui.bindings extension.</li>
	</ol>
	</li>
</ol>
<ul>
	<li>Only 1 scheme is active at a time.  So if you create a new scheme you have to create new bindings for every command that you want to use in your application.</li>
	<li>To activate a new scheme you must create a plugin_customization.ini file in your application plugin or choose a new scheme in the Window &gt; Preferences &gt; Keys preference page.
	<ol>
		<li>Define a key binding for your command (part of the org.eclipse.ui.bindings extension).  In the key binding definition you have to declare which command the binding applies to, the context that the binding will be active in and the scheme that the binding is part of.</li>
	</ol>
	</li>
</ul>
<ol>
	<li>You are now done the extension definition, now you must programmatically bind the command to an action.
	<ol>
		<li>When you create your action set the definitionID to the command's id.</li>
	</ol>
	</li>
</ol>
<ul>
	<li><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">action.setActionDefinitionId(<span class="code-quote">"yourCommandsID"</span>);</pre>
</div></div>
	<ol>
		<li>Next you must register your command with the current site's keybinding service.</li>
	</ol>
	</li>
	<li><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">part.getSite().getKeyBindingService().registerAction(action);</pre>
</div></div>
	<ol>
		<li>During the creation of a view the context that are active must be defined as well.  By default org.eclipse.ui.contexts.window context is active so if you keybinding is part of that context then you can skip this step.</li>
	</ol>
	</li>
	<li><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">site.getKeyBindingService().setScopes(<span class="code-keyword">new</span> <span class="code-object">String</span>[] {<span class="code-quote">"yourContextID"</span>});</pre>
</div></div></li>
</ul>


<p><b>Tips</b><br/>
The ToolManager's contributeGlobalActions() sets all the "normal" uDig actions such as copy, paste, delete, undo, redo, etc...  The ToolManager can be obtained with the method ApplicationGIS.getToolManager().</p>

<p><b>Example:</b></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag"><span class="code-comment">&lt;!-- This is part of org.eclipse.ui plugin.xml --&gt;</span></span>
      &lt;extension
            point=<span class="code-quote">"org.eclipse.ui.contexts"</span>&gt;
         &lt;context
               description=<span class="code-quote">"%context.tool.description"</span>
               id=<span class="code-quote">"net.refractions.udig.project.ui.tool"</span>
               name=<span class="code-quote">"%Tools"</span>
               parentId=<span class="code-quote">"org.eclipse.ui.contexts.window"</span>/&gt;
      <span class="code-tag">&lt;/extension&gt;</span>
<span class="code-tag"><span class="code-comment">&lt;!-- This is part of net.refractions.udig.project.ui plugin.xml --&gt;</span></span>
      &lt;extension
         point=<span class="code-quote">"org.eclipse.ui.commands"</span>&gt;
        &lt;command
            categoryId=<span class="code-quote">"net.refractions.udig.tools.toolCategory"</span>
            name=<span class="code-quote">"%zoom.category.name"</span>
            id=<span class="code-quote">"net.refractions.udig.tools.ZoomCommand"</span>/&gt;
      <span class="code-tag">&lt;/extension&gt;</span>
   &lt;extension
         point=<span class="code-quote">"org.eclipse.ui.bindings"</span>&gt;
      &lt;key
            commandId=<span class="code-quote">"net.refractions.udig.tools.ZoomCommand"</span>
            contextId=<span class="code-quote">"net.refractions.udig.project.ui.tool"</span>
            sequence=<span class="code-quote">"Z"</span> schemeId=<span class="code-quote">"net.refractions.udig.defaultUDIGKeyConfiguration"</span>/&gt;
      <span class="code-tag">&lt;/extension&gt;</span></pre>
</div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// This is made up to illustrate the concept
</span>class NewView <span class="code-keyword">extends</span> Viewpart {
  <span class="code-keyword">public</span> void createPartControl( Composite parent ){
    <span class="code-comment">// You don't need <span class="code-keyword">this</span> step because it is included by <span class="code-keyword">default</span>
</span>    <span class="code-object">String</span>[] newScopes = <span class="code-keyword">new</span> <span class="code-object">String</span>[];
    newScopes[0] = <span class="code-quote">"net.refractions.udig.project.ui.tool"</span>;           
    getSite().getKeyBindingService().setScopes(newScopes);

    <span class="code-comment">// Create action, assign and register action and its command
</span>    IAction action=createAction();
    Action.setActionDefinitionId(<span class="code-quote">"net.refractions.udig.tools.ZoomCommand"</span>);
    IKeyBindingService service = part.getSite().getKeyBindingService();
    service.registerAction(action);
  }
}</pre>
</div></div>

<p><b>Resources</b></p>
<ul>
	<li>See the org.eclipse.ui plugin.xml for many existing commmands, categories, keybindings, contexts and schemes.</li>
	<li><a href="http://www.magma.ca/~pollockd/despumate/bindingsHowTo.html">http://www.magma.ca/~pollockd/despumate/bindingsHowTo.html</a></li>
</ul>


<small>
  (c) Copyright (c) 2004-2008 Refractions Research Inc. and others.<br>
  <a href="http://udig.refractions.net/confluence/pages/viewpage.action?pageId=8553">[wiki]</a>
</small>
    </body>
</html>
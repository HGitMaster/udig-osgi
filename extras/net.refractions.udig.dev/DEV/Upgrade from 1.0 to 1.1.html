<html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="../book.css" type="text/css" />
        <title>UDIG Developer Guide : Upgrade from 1.0 to 1.1</title>
    </head>
    <body BGCOLOR="#FFFFFF">
       <!-- UDIG Developer Guide : Upgrade from 1.0 to 1.1 -->
       <h1>Upgrade from 1.0 to 1.1</h1>

       <p>The number of changes between uDig 1.0 and uDig 1.1 has been kept to a minimum. The following are known considerations at this time.</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> GIS Application </th>
<th class='confluenceTh'> GIS Platform </th>
<td class='confluenceTd'> GeoTools </td>
</tr>
<tr>
<td class='confluenceTd'> <a href="#Upgradefrom1.0to1.1-IRenderer">IRenderer</a> </td>
<td class='confluenceTd'> <a href="#Upgradefrom1.0to1.1-IResolve">IResolve</a> </td>
<td class='confluenceTd'> <a href="http://docs.codehaus.org/display/GEOTOOLS/Upgrade+to+2.4">Upgrade to GeoTools 2.4</a> </td>
</tr>
<tr>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> <a href="#Upgradefrom1.0to1.1-IService">IService</a> </td>
<td class='confluenceTd'> <a href="GeoTools 2.5 for uDig Developers.html" title="GeoTools 2.5 for uDig Developers">GeoTools 2.5 for uDig Developers</a> </td>
</tr>
<tr>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> <a href="#Upgradefrom1.0to1.1-IGeoResource">IGeoResource</a> </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> <a href="#Upgradefrom1.0to1.1-ServiceExtension.exsd">ServiceExtension.exsd</a> </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>

<h1><a name="Upgradefrom1.0to1.1-GISApplication"></a>GIS Application</h1>

<h2><a name="Upgradefrom1.0to1.1-GISApplication%3AIRenderer"></a><a name="Upgradefrom1.0to1.1-IRenderer"></a> GIS Application: IRenderer</h2>

<p>Now proivides information on just the bounds to be drawn.</p>
<ul>
	<li>you will need to change method signature</li>
	<li>get/setRenderBounds added</li>
</ul>


<p>Please note that simply implementing IRenderer is not sufficient; you will need to extend <b>RenderImpl</b>.</p>

<h3><a name="Upgradefrom1.0to1.1-BEFORE%28uDig1.0%29"></a>BEFORE (uDig 1.0)</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyRenderer <span class="code-keyword">extends</span> RenderImpl {
    render( Envelope bounds, IProgressMonitor monitor ){ 
        ...
    }
}</pre>
</div></div>

<h3><a name="Upgradefrom1.0to1.1-AFTER%28uDig1.1%29"></a>AFTER (uDig 1.1)</h3>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyRenderer <span class="code-keyword">extends</span> RenderImpl {
    render( IProgressMonitor monitor ){
        Envelope bounds = getRenderBounds();
        ...
    }
}</pre>
</div></div>

<p>Note the superclass RenderImpl provides the implementation of get/setRenderBounds().</p>

<h1><a name="Upgradefrom1.0to1.1-GISPlatform"></a>GIS Platform</h1>

<h2><a name="Upgradefrom1.0to1.1-GISApplication%3AIRenderer"></a><a name="Upgradefrom1.0to1.1-IRender"></a> GIS Application: IRenderer</h2>

<p>We are handling members differently.</p>
<ul>
	<li>resolve( List.class, monitor ) no longer needs to evaulate to members</li>
	<li>members( monitor ) uses Collections.EMPTY_LIST to indicate a leaf</li>
</ul>


<h3><a name="Upgradefrom1.0to1.1-BEFORE%28uDig1.0%29"></a>BEFORE (uDig 1.0)</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyResolve <span class="code-keyword">implements</span> IRender {
   <span class="code-keyword">public</span> List members( Monitor ){
       <span class="code-keyword">return</span> <span class="code-keyword">null</span>; <span class="code-comment">// I am a leaf
</span>   }
}</pre>
</div></div>

<h3><a name="Upgradefrom1.0to1.1-AFTER%28uDig1.1%29"></a>AFTER (uDig 1.1)</h3>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyResolve <span class="code-keyword">implements</span> IRender {
   <span class="code-keyword">public</span> List&lt;IResolve&gt; members( Monitor ){
       <span class="code-keyword">return</span> Collections.emptyList(); <span class="code-comment">// I am a leaf
</span>   }
}</pre>
</div></div>

<h2><a name="Upgradefrom1.0to1.1-GISPlatform%3AIService"></a><a name="Upgradefrom1.0to1.1-IService"></a> GIS Platform: IService</h2>

<p>IService now makes use of a ResolveManager in order to allow the addition of adapters by other plug-ins. We have also moved the api contract from javadocs directly into the superclass implementation.</p>

<p>Consequences:</p>
<ul>
	<li>implement getInfo( monitor )</li>
	<li>canResolve implementation needs to call super, remove references to List, IService or ServiceInfo</li>
	<li>resolve implementation needs to call super, remove any resolve code that works on List, IService or ServiceInfo</li>
</ul>


<p>QA Warnings:</p>
<ul>
	<li>please ensure canResolve( null ) returns false</li>
</ul>


<h3><a name="Upgradefrom1.0to1.1-BEFORE%28uDig1.0%29"></a>BEFORE (uDig 1.0)</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyService <span class="code-keyword">extends</span> IService {
<span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
   <span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
        <span class="code-keyword">if</span>( monitor == <span class="code-keyword">null</span> ) monitor = <span class="code-keyword">new</span> NullProgressMonitor();
        
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( DataStore.class ) ){
             <span class="code-keyword">return</span> getDataStore( monitor );
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( IService.class ) ){
             <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( IServiceInfo.class ) ){
             <span class="code-keyword">return</span> <span class="code-keyword">new</span> MyServiceInfo( monitor );
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( List.class ) ){
             <span class="code-keyword">return</span> members( monitor );
        }
        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
   }  

}</pre>
</div></div>

<h3><a name="Upgradefrom1.0to1.1-AFTER%28uDig1.1%29"></a>AFTER (uDig 1.1)</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyService <span class="code-keyword">extends</span> IService {
   MyServiceInfo info = <span class="code-keyword">null</span>;
   <span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
        <span class="code-keyword">if</span>( monitor == <span class="code-keyword">null</span> ) monitor = <span class="code-keyword">new</span> NullProgressMonitor();
        
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( DataStore.class ) ){
             <span class="code-keyword">return</span> getDataStore( monitor );
        }
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.resolve( adaptee, monitor );
   }  
   <span class="code-keyword">public</span> synchornized ServiceInfo getInfo( Monitor monitor ){
        <span class="code-keyword">if</span>( info != <span class="code-keyword">null</span> ){
            info = <span class="code-keyword">new</span> MyServiceInfo( monitor );
        }
        <span class="code-keyword">return</span> info;
   }
}</pre>
</div></div>

<h2><a name="Upgradefrom1.0to1.1-GISPlatform%3AIGeoResource"></a><a name="Upgradefrom1.0to1.1-IGeoResource"></a> GIS Platform: IGeoResource</h2>

<p>IGeoResourcenow makes use of a ResolveManager and javadoc contract coded directly into the superclass. We have also split the functionality of the parent method into seperate method to allow for nested IGeoResources.</p>

<p>Consequences:</p>
<ul>
	<li>implement parent( monitor )</li>
	<li>implement getInfo( monitor )</li>
	<li>canResolve implementation needs to call super, remove references to List, IGeoResource or IGeoResourceInfo</li>
	<li>resolve implementation needs to call super, remove references to List, IGeoResource or IGeoResourceInfo</li>
</ul>


<p>QA Warnings:</p>
<ul>
	<li>please ensure canResolve( null ) returns false</li>
</ul>


<h3><a name="Upgradefrom1.0to1.1-BEFORE%28uDig1.0%29"></a>BEFORE (uDig 1.0)</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyGeoResource <span class="code-keyword">extends</span> IGeoResource {
<span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
   <span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
        <span class="code-keyword">if</span>( monitor == <span class="code-keyword">null</span> ) monitor = <span class="code-keyword">new</span> NullProgressMonitor();
        
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( FeatureSource.class ) ){
             <span class="code-keyword">return</span> getFeatureSource( monitor );
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( IGeoResource.class ) ){
             <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( IGeoResourceInfo.class ) ){
             <span class="code-keyword">return</span> <span class="code-keyword">new</span> MyGeoResourceInfo( monitor );
        }
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( List.class ) ){
             <span class="code-keyword">return</span> members( monitor );
        }
        <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
   }
}</pre>
</div></div>

<h3><a name="Upgradefrom1.0to1.1-AFTER%28uDig1.1%29"></a>AFTER (uDig 1.1)</h3>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class MyGeoResource <span class="code-keyword">extends</span> IGeoResource {
   MyGeoResourceInfoinfo = <span class="code-keyword">null</span>;
   <span class="code-keyword">public</span> &lt;T&gt; T resolve( <span class="code-object">Class</span>&lt;T&gt; adaptee, IProgressMonitor monitor ){
        <span class="code-keyword">if</span>( monitor == <span class="code-keyword">null</span> ) monitor = <span class="code-keyword">new</span> NullProgressMonitor();
        
        <span class="code-keyword">if</span>( adaptee.isAssignableFrom( FeatureSource.class ) ){
             <span class="code-keyword">return</span> getFeatureSource( monitor );
        }
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.resolve( adaptee, monitor );
   }  
   <span class="code-keyword">public</span> synchornized IGeoResourceInfo getInfo( Monitor monitor ){
        <span class="code-keyword">if</span>( info != <span class="code-keyword">null</span> ){
            info = <span class="code-keyword">new</span> MyGeoResourceInfo( monitor );
        }
        <span class="code-keyword">return</span> info;
   }
}</pre>
</div></div>

<h2><a name="Upgradefrom1.0to1.1-ServiceExtension.exsd"></a>ServiceExtension.exsd</h2>
<p>The serviceExtension extension point has had a new required attribute added:  id.  Now each service extension must have id defined for the attribute.  A name attribute has also been added.  </p>

<h3><a name="Upgradefrom1.0to1.1-BEFORE"></a>BEFORE</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;extension
         point=<span class="code-quote">"net.refractions.udig.catalog.ServiceExtension"</span>&gt;
      &lt;service
          class=<span class="code-quote">"net.refractions.udig.catalog.memory.MemoryServiceExtensionImpl"</span>/&gt;
   <span class="code-tag">&lt;/extension&gt;</span></pre>
</div></div>

<h3><a name="Upgradefrom1.0to1.1-AFTER"></a>AFTER</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;extension
         point=<span class="code-quote">"net.refractions.udig.catalog.ServiceExtension"</span>&gt;
      &lt;service
            class=<span class="code-quote">"net.refractions.udig.catalog.memory.MemoryServiceExtensionImpl"</span> 
            id=<span class="code-quote">"memory"</span>
            name=<span class="code-quote">"In-Memory Datastore"</span>/&gt;
   <span class="code-tag">&lt;/extension&gt;</span></pre>
</div></div>

<small>
  (c) Copyright (c) 2004-2008 Refractions Research Inc. and others.<br>
  <a href="http://udig.refractions.net/confluence/pages/viewpage.action?pageId=9403">[wiki]</a>
</small>
    </body>
</html>